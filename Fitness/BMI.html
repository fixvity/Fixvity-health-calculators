<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BMI Gauge — Fixed</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f4f8fb; --card:#fff; --muted:#6b7176; --accent:#10707a; --danger:#ef4444;
    --ok:#1eb77b; --warn:#f59e0b; --deep:#0a2f32; --border:rgba(10,15,20,0.06);
  }
  html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:1040px;margin:24px auto;padding:12px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 24px 40px rgba(8,12,16,0.06);padding:18px}
  h1{margin:0 0 8px;font-size:28px}
  .row{display:flex;gap:24px;align-items:flex-start}
  .left{flex:1}
  .right{width:520px}
  .input{width:100%;padding:12px;border-radius:8px;border:1px solid var(--border);margin-bottom:10px;font-size:15px}
  .btn{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:white;font-weight:700;cursor:pointer}
  .btnGhost{padding:9px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
  .controls{display:flex;gap:8px;margin-top:8px}
  label{display:block;margin-bottom:6px;color:var(--muted)}
  /* RESULT area matches screenshot style */
  .resultCard{background:transparent;padding:6px 0}
  .gaugeWrap{background:var(--card);border-radius:10px;padding:18px;border:1px solid var(--border)}
  /* big centered text placed inside the semicircle */
  .centerText{display:flex;align-items:center;gap:12px;justify-content:center;flex-direction:row;flex-wrap:wrap}
  .bmiBig{font-weight:800;color:var(--deep);font-size:44px;line-height:0.9}
  .unit{font-size:18px;color:var(--muted);align-self:flex-end}
  .bmiStatus{font-weight:800;color:var(--ok);font-size:20px;margin-left:8px}
  .timestamp{color:var(--muted);font-size:12px;margin-left:10px}

  /* Responsive tuning: reduce the giant number on small screens */
  @media(max-width:560px){
    .right{width:100%}
    .bmiBig{font-size:34px}
    .unit{font-size:14px}
    .bmiStatus{font-size:18px}
  }

  /* SVG container sizing */
  .svgHolder{width:100%;display:flex;justify-content:center;align-items:center}
  svg{max-width:100%;height:auto;display:block}
  .legend{display:flex;flex-direction:column;gap:8px;margin-top:18px}
  .pill{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;border:1px solid var(--border);background:#fff;font-weight:700}
  .detailBoxes{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  .infoBox{background:#fff;padding:10px;border-radius:10px;border:1px solid var(--border)}
  .muted{color:var(--muted)}
  /* center alignment for desktop: put the big BMI value centered under the arc */
  .resultRow{display:flex;align-items:flex-start;gap:16px;justify-content:space-between}
  .leftCol{flex:1}
  .rightCol{width:220px}
</style>
</head>
<body>

<div class="wrap">
  <div class="card">
    <h1>Result</h1>

    <div class="row">
      <div class="left">
        <label>Age (years)</label>
        <input id="age" class="input" type="number" placeholder="25" min="2" max="120">
        <label>Sex</label>
        <select id="sex" class="input">
          <option value="">Prefer not to say</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>

        <label>Weight (kg)</label>
        <input id="weightKg" class="input" type="number" step="0.1" placeholder="65">

        <label>Height (cm)</label>
        <input id="heightCm" class="input" type="number" step="0.1" placeholder="180">

        <div class="controls">
          <button id="calculate" class="btn">Calculate</button>
          <button id="clear" class="btnGhost">Clear</button>
          <button id="savePNG" class="btnGhost">save</button>
        </div>
      </div>

      <!-- Right (result) -->
      <div class="right">
        <div class="gaugeWrap" id="resultArea">
          <!-- big centered line "BMI = 20.1 kg/m2 (Normal)" will be laid over SVG -->
          <div class="svgHolder">
            <!-- semicircle gauge SVG. Needle pivot is at (450, 360) in this viewBox.
                 We draw colored segments then a central pivot and a rotating needle group. -->
            <svg id="gsvg" viewBox="0 0 900 420" preserveAspectRatio="xMidYMid meet" aria-hidden="false">
              <!-- background faint arc -->
              <path d="M80 360 A320 320 0 0 1 820 360" stroke="#e9eef0" stroke-width="48" fill="none" stroke-linecap="round" />
              <!-- segments: we'll draw arcs for each zone -->
              <g id="segGroup"></g>

              <!-- tick marks & numbers -->
              <g id="ticks"></g>

              <!-- needle group: rotate this around pivot (450,360) -->
              <g id="needleGroup" transform="rotate(-90 450 360)">
                <!-- needle shaft -->
                <rect x="446" y="240" width="8" height="130" rx="4" fill="#08121a" opacity="0.98" />
                <!-- arrowhead -->
                <polygon points="450,232 438,252 462,252" fill="#08121a"/>
              </g>

              <!-- pivot circle -->
              <circle cx="450" cy="360" r="10" fill="#cbd5d8"/>
            </svg>
          </div>

          <!-- overlay the big result text in the center under the arc -->
          <div style="margin-top:-34px;text-align:center">
            <div style="display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap">
              <div style="font-weight:900;font-size:28px">BMI =</div>
              <div id="bmiText" class="bmiBig">—</div>
              <div class="unit">kg/m²</div>
              <div id="bmiLabel" class="bmiStatus muted">—</div>
            </div>
            <div id="ts" class="timestamp" style="text-align:center;margin-top:6px">—</div>
          </div>

          <!-- legend & details -->
          <div style="display:flex;gap:12px;margin-top:16px;align-items:flex-start">
            <div style="flex:1">
              <div class="pill"><span style="display:inline-block;width:14px;height:14px;background:#ef4444;border-radius:8px"></span> Underweight</div>
              <div style="height:8px"></div>
              <div class="pill"><span style="display:inline-block;width:14px;height:14px;background:#1eb77b;border-radius:8px"></span> Normal</div>
              <div style="height:8px"></div>
              <div class="pill"><span style="display:inline-block;width:14px;height:14px;background:#f59e0b;border-radius:8px"></span> Overweight</div>
              <div style="height:8px"></div>
              <div class="pill"><span style="display:inline-block;width:14px;height:14px;background:#ff8c42;border-radius:8px"></span> Obesity I</div>
              <div style="height:8px"></div>
              <div class="pill"><span style="display:inline-block;width:14px;height:14px;background:#e74c3c;border-radius:8px"></span> Obesity II</div>
              <div style="height:8px"></div>
              <div class="pill"><span style="display:inline-block;width:14px;height:14px;background:#812525;border-radius:8px"></span> Obesity III</div>
            </div>

            <div style="flex:1">
              <div class="infoBox"><div class="muted">Healthy BMI range</div><div style="font-weight:800;margin-top:6px">18.5 — 24.9</div></div>
              <div style="height:8px"></div>
              <div class="infoBox"><div class="muted">BMI Prime</div><div id="prime" style="font-weight:800;margin-top:6px">—</div></div>
              <div style="height:8px"></div>
              <div class="infoBox"><div class="muted">Ponderal Index</div><div id="ponderal" style="font-weight:800;margin-top:6px">—</div></div>
              <div style="height:8px"></div>
              <div class="infoBox"><div class="muted">Healthy weight</div><div id="hw" style="font-weight:800;margin-top:6px">—</div></div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* ====== Gauge / UI logic (self-contained) ====== */
const segGroup = document.getElementById('segGroup');
const ticks = document.getElementById('ticks');
const needleGroup = document.getElementById('needleGroup');
const bmiText = document.getElementById('bmiText');
const bmiLabel = document.getElementById('bmiLabel');
const ts = document.getElementById('ts');
const prime = document.getElementById('prime');
const ponderal = document.getElementById('ponderal');
const hw = document.getElementById('hw');

const calculateBtn = document.getElementById('calculate');
const clearBtn = document.getElementById('clear');
const savePNG = document.getElementById('savePNG');

const weightKg = document.getElementById('weightKg');
const heightCm = document.getElementById('heightCm');

const viewBoxW = 900, viewBoxH = 420, cx = 450, cy = 360, R = 320;

/* ranges like screenshot 2 (0-18.5 under, 18.5-25 normal, 25-30 ow, 30-35 I, 35-40 II, 40-60 III) */
const ranges = [
  { from: 0, to: 18.5, color:'#ef4444' },
  { from: 18.5, to: 24.9, color:'#1eb77b' },
  { from: 25, to: 29.9, color:'#f59e0b' },
  { from: 30, to: 34.9, color:'#ff8c42' },
  { from: 35, to: 39.9, color:'#e74c3c' },
  { from: 40, to: 60, color:'#812525' },
];

function degFor(value){
  // map 0..60 to -90..+90
  const v = Math.min(Math.max(value,0),60);
  return (v/60)*180 - 90;
}
function polar(r,deg){ const rad=(deg-90)*Math.PI/180; return {x: cx + r*Math.cos(rad), y: cy + r*Math.sin(rad)}; }
function arcPath(r,startDeg,endDeg){
  const a = polar(r,startDeg), b = polar(r,endDeg);
  const large = (Math.abs(endDeg-startDeg) > 180) ? 1 : 0;
  return `M ${a.x} ${a.y} A ${r} ${r} 0 ${large} 1 ${b.x} ${b.y}`;
}

/* draw colored segments and ticks */
function drawSegments(){
  segGroup.innerHTML = '';
  ranges.forEach(rg=>{
    const s = degFor(rg.from), e = degFor(rg.to);
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', arcPath(R,s,e));
    path.setAttribute('stroke', rg.color);
    path.setAttribute('stroke-width', 48);
    path.setAttribute('fill','none');
    path.setAttribute('stroke-linecap','butt');
    segGroup.appendChild(path);
  });

  // ticks and labels
  ticks.innerHTML = '';
  [0,10,15,18.5,20,25,30,35,40,50,60].forEach(v=>{
    const d = degFor(v);
    const p1 = polar(R+30,d), p2 = polar(R-18,d);
    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',p1.x); line.setAttribute('y1',p1.y);
    line.setAttribute('x2',p2.x); line.setAttribute('y2',p2.y);
    line.setAttribute('stroke','#d8dde0'); line.setAttribute('stroke-width',2);
    ticks.appendChild(line);
    const pt = polar(R+60,d);
    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x',pt.x); t.setAttribute('y',pt.y+6); t.setAttribute('text-anchor','middle');
    t.setAttribute('font-size',14); t.setAttribute('fill','#233');
    t.setAttribute('font-weight',700);
    t.textContent = (Number.isInteger(v) ? String(v) : v);
    ticks.appendChild(t);
  });
}
drawSegments();

/* map bmi -> rotation */
function setNeedle(bmi){
  const deg = degFor(bmi);
  // rotate around pivot cx,cy
  needleGroup.setAttribute('transform', `rotate(${deg} ${cx} ${cy})`);
}

/* categorize */
function category(bmi){
  if(bmi < 18.5) return {label:'Underweight', color:'#ef4444', interp:'Below healthy range.'};
  if(bmi < 25) return {label:'Normal', color:'#1eb77b', interp:'Within healthy range.'};
  if(bmi < 30) return {label:'Overweight', color:'#f59e0b', interp:'Above healthy range.'};
  if(bmi < 35) return {label:'Obesity I', color:'#ff8c42', interp:'Clinical obesity I.'};
  if(bmi < 40) return {label:'Obesity II', color:'#e74c3c', interp:'Clinical obesity II.'};
  return {label:'Obesity III', color:'#812525', interp:'Severe obesity.'};
}

/* calculation */
function computeAndRender(){
  const w = parseFloat(weightKg.value);
  const hcm = parseFloat(heightCm.value);
  if(!(w>0) || !(hcm>0)){ alert('Enter valid weight and height.'); return; }
  const m = hcm/100;
  const bmi = w / (m*m);
  // update UI
  bmiText.textContent = bmi.toFixed(2);
  const cat = category(bmi);
  bmiLabel.textContent = `(${cat.label})`;
  bmiLabel.style.color = cat.color;
  ts.textContent = `Last: ${new Date().toLocaleString()}`;

  // other metrics
  prime.textContent = (bmi/25).toFixed(2);
  ponderal.textContent = ( w / (m*m*m) ).toFixed(2) + ' kg/m³';
  const low = (18.5*m*m).toFixed(1), high=(24.9*m*m).toFixed(1);
  hw.textContent = `${low} kg — ${high} kg`;

  // set needle
  setNeedle(bmi);
}

/* events */
calculateBtn.addEventListener('click', computeAndRender);
clearBtn.addEventListener('click', ()=>{
  weightKg.value=''; heightCm.value=''; bmiText.textContent='—'; bmiLabel.textContent='—'; ts.textContent='—';
  prime.textContent='—'; ponderal.textContent='—'; hw.textContent='—';
  setNeedle(0);
});
savePNG.addEventListener('click', ()=>{
  // very small snap - use svg outerHTML + inline css to produce image easily
  const out = document.getElementById('resultArea');
  html2canvas(out, {scale:2, backgroundColor:'#fff'}).then(canvas=>{
    const a = document.createElement('a'); a.href = canvas.toDataURL('image/png'); a.download = 'bmi-result.png'; a.click();
  }).catch(err=>alert('Export failed'));
});

/* load html2canvas lazily for PNG export (only when Save clicked we'll load) */
(function addHtml2Canvas(){
  const s=document.createElement('script');
  s.src = "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
  s.defer=true; document.head.appendChild(s);
})();

/* sensible initial state */
setNeedle(0);

/* allow Enter key to calculate */
[weightKg,heightCm].forEach(el => el.addEventListener('keydown', e => { if(e.key==='Enter') computeAndRender(); }));
</script>
</body>
</html>
