<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fixvity — BMI Calculator (Detailed)</title>
<meta name="description" content="Detailed BMI calculator with gauge, healthy range, BMI Prime and Ponderal Index. Metric & Imperial." />
<style>
  :root{
    --bg:#f4f7fb;
    --card:#06121a;
    --muted:#90a0ad;
    --accent:#10b981;
    --accent-2:#06b3a0;
    --warn:#f59e0b;
    --danger:#ef4444;
    --glass: rgba(255,255,255,0.03);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  html,body{height:100%;margin:0;background:var(--bg);-webkit-font-smoothing:antialiased;}
  .wrap{max-width:980px;margin:28px auto;padding:18px;box-sizing:border-box}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
  .brand{font-weight:800;font-size:18px;color:#0b1a22}
  .sub{color:var(--muted);font-size:13px}
  .panel{background:linear-gradient(180deg,#07121a,#06111a);border-radius:14px;padding:18px;color:#e9f2f6;box-shadow:0 18px 40px rgba(6,20,25,0.12)}
  .layout{display:grid;grid-template-columns:1fr 420px;gap:18px}
  @media(max-width:920px){ .layout{grid-template-columns:1fr} }
  /* Inputs */
  .inputs{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media(max-width:700px){ .inputs{grid-template-columns:1fr} }
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  .field{background:var(--glass);border-radius:10px;padding:10px}
  input[type="number"], select{width:100%;padding:10px;border-radius:8px;border:0;background:transparent;color:#e9f2f6;font-size:15px}
  .seg{background:rgba(255,255,255,0.03);padding:6px;border-radius:999px;display:inline-flex}
  .seg button{border:0;background:transparent;color:var(--muted);padding:8px 12px;border-radius:999px;cursor:pointer}
  .seg button.active{background:var(--accent);color:#04201b;box-shadow:0 6px 18px rgba(16,185,129,0.12)}
  .controls-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .full{grid-column:1/-1}
  .muted{color:var(--muted);font-size:13px}
  button.btn{background:var(--accent);border:0;color:#04201b;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px}
  /* Right panel results */
  .result{background:linear-gradient(180deg,#08131a,#061016);border-radius:12px;padding:18px;color:#e9f2f6;display:flex;flex-direction:column;gap:12px}
  .resultTop{display:flex;gap:12px;align-items:center}
  .gauge{width:160px;height:160px;flex:0 0 160px;position:relative}
  svg{display:block}
  .gauge .value{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
  .bmiLarge{font-family:ui-monospace,Menlo,monospace;font-size:26px;font-weight:800}
  .bmiCat{font-size:14px;color:var(--muted)}
  .bullets{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;color:var(--muted);font-size:14px}
  .bullets ul{margin:6px 0 0 18px;padding:0}
  .statRow{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .stat{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px;font-weight:600}
  .help{color:var(--muted);font-size:13px}
  .history{background:rgba(255,255,255,0.02);padding:8px;border-radius:10px;max-height:180px;overflow:auto;color:var(--muted)}
  .histItem{display:flex;justify-content:space-between;align-items:center;padding:6px;border-bottom:1px dashed rgba(255,255,255,0.02)}
  /* small */
  .small{font-size:13px;color:var(--muted)}
  .center{text-align:center}
  /* accessibility */
  button:focus, input:focus, select:focus { box-shadow:0 0 0 3px rgba(16,185,129,0.12); outline:none; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="brand">Fixvity — Detailed BMI Calculator</div>
        <div class="sub">Metric & Imperial • BMI Prime • Ponderal Index • Healthy range & weight</div>
      </div>
      <div class="small muted">Accurate, mobile-friendly, and ready for GitHub Pages</div>
    </header>

    <main class="panel" role="main">
      <div class="layout">
        <!-- LEFT: input form -->
        <section aria-label="BMI Inputs">
          <div style="margin-bottom:10px" class="small">Enter weight & height — results update live. Use the Calculate button for focus.</div>

          <div class="inputs" role="form" aria-label="BMI form">
            <div class="field" style="grid-column:span 2;">
              <label>Units</label>
              <div class="seg" role="tablist" aria-label="Units">
                <button id="btnMetric" class="active" aria-pressed="true">Metric</button>
                <button id="btnImperial" aria-pressed="false">Imperial</button>
              </div>
            </div>

            <div class="field">
              <label for="weight">Weight</label>
              <input id="weight" type="number" min="0" step="0.1" inputmode="decimal" placeholder="kg">
              <div class="small muted" id="weightHelp">kilograms (kg)</div>
            </div>

            <div class="field" id="heightCmField">
              <label for="heightCm">Height (cm)</label>
              <input id="heightCm" type="number" min="0" step="0.1" inputmode="decimal" placeholder="cm">
              <div class="small muted" id="heightHelp">centimetres (cm)</div>
            </div>

            <div class="field" id="feetField" style="display:none">
              <label for="feet">Feet</label>
              <input id="feet" type="number" min="0" step="1" inputmode="numeric" placeholder="ft">
            </div>
            <div class="field" id="inchesField" style="display:none">
              <label for="inches">Inches</label>
              <input id="inches" type="number" min="0" step="0.1" inputmode="decimal" placeholder="in">
            </div>

            <div class="field">
              <label for="age">Age (optional)</label>
              <input id="age" type="number" min="1" max="120" step="1" placeholder="years">
            </div>
            <div class="field">
              <label for="sex">Sex (optional)</label>
              <select id="sex">
                <option value="">Prefer not to say</option>
                <option value="female">Female</option>
                <option value="male">Male</option>
              </select>
            </div>

            <div class="field full" style="display:flex;align-items:center;justify-content:space-between;gap:10px">
              <div class="small muted">Tip: press Enter on inputs to calculate.</div>
              <div>
                <button id="calc" class="btn" title="Calculate BMI">Calculate</button>
                <button id="clear" class="ghost" style="margin-left:8px">Clear</button>
              </div>
            </div>
          </div>
        </section>

        <!-- RIGHT: result panel -->
        <aside aria-label="Results">
          <div class="result" role="region" aria-live="polite">
            <div class="resultTop">
              <div class="gauge" aria-hidden="true">
                <svg viewBox="0 0 160 160" width="160" height="160">
                  <defs>
                    <linearGradient id="lg" x1="0" x2="1">
                      <stop offset="0%" stop-color="#10b981"/>
                      <stop offset="70%" stop-color="#f59e0b"/>
                      <stop offset="100%" stop-color="#ef4444"/>
                    </linearGradient>
                  </defs>
                  <!-- background arc -->
                  <path d="M10 100 A70 70 0 0 1 150 100" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="20" stroke-linecap="round"></path>
                  <!-- progress arc (stroke-dasharray) -->
                  <path id="arc" d="M10 100 A70 70 0 0 1 150 100" fill="none" stroke="url(#lg)" stroke-width="20" stroke-linecap="round" stroke-dasharray="220" stroke-dashoffset="220" transform="translate(0,0)"></path>
                </svg>
                <div class="value">
                  <div class="bmiLarge" id="bmiNum">—</div>
                  <div class="bmiCat" id="bmiCat">Enter values</div>
                </div>
              </div>

              <div style="flex:1">
                <div style="display:flex;justify-content:space-between;align-items:center">
                  <div>
                    <div class="small muted">BMI</div>
                    <div id="bmiText" style="font-size:15px;font-weight:700;color:#e9f2f6">—</div>
                  </div>
                  <div style="text-align:right">
                    <div class="small muted">Last calc</div>
                    <div id="last" class="small muted">—</div>
                  </div>
                </div>

                <div style="margin-top:10px">
                  <div class="bullets" id="bulletbox">
                    <div style="font-size:13px;color:var(--muted)">Results</div>
                    <ul id="resultsList">
                      <li>BMI: —</li>
                      <li>Category: —</li>
                      <li>Healthy BMI range: 18.5 — 25</li>
                      <li>Healthy weight for height: —</li>
                      <li>BMI Prime: —</li>
                      <li>Ponderal Index: —</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="help" id="advice">—</div>
              <div>
                <button id="copy" class="ghost">Copy</button>
                <button id="save" class="ghost" style="margin-left:8px">Save</button>
              </div>
            </div>

            <div>
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div class="small muted">Saved history</div>
                <div><button id="clearHist" class="ghost">Clear</button></div>
              </div>
              <div class="history" id="history">No saved results.</div>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

<script>
/* Detailed BMI Calculator JS
   - supports metric and imperial
   - shows BMI prime & ponderal index
   - healthy weight range uses BMI 18.5 - 25 (per screenshot)
   - localStorage history
*/

// elements
const btnMetric = document.getElementById('btnMetric');
const btnImperial = document.getElementById('btnImperial');
const weightEl = document.getElementById('weight');
const heightCmEl = document.getElementById('heightCm');
const feetField = document.getElementById('feetField');
const inchesField = document.getElementById('inchesField');
const feetEl = document.getElementById('feet');
const inchesEl = document.getElementById('inches');
const ageEl = document.getElementById('age');
const sexEl = document.getElementById('sex');
const calcBtn = document.getElementById('calc');
const clearBtn = document.getElementById('clear');

const bmiNum = document.getElementById('bmiNum');
const bmiCat = document.getElementById('bmiCat');
const bmiText = document.getElementById('bmiText');
const resultsList = document.getElementById('resultsList');
const bulletBox = document.getElementById('bulletbox');
const arc = document.getElementById('arc');
const lastEl = document.getElementById('last');
const adviceEl = document.getElementById('advice');

const saveBtn = document.getElementById('save');
const copyBtn = document.getElementById('copy');
const historyEl = document.getElementById('history');
const clearHistBtn = document.getElementById('clearHist');

const STORAGE = 'fixvity_bmi_v2';

// state
let units = 'metric';
let lastResult = null;

// helpers
const toNum = v => { const n = Number(v); return Number.isFinite(n)?n:null; };
const round = (n, d=1) => { if(!Number.isFinite(n)) return '—'; return Number(parseFloat(n).toFixed(d)); };

// conversions & math
function heightMetersMetric(cm){ const c = toNum(cm); if(c===null||c<=0) return null; return c/100; }
function heightMetersImperial(ft, inch){ const f = toNum(ft)||0, i = toNum(inch)||0; const total = f*12 + i; if(total<=0) return null; return total * 0.0254; }
function weightKgMetric(kg){ const k = toNum(kg); if(k===null||k<=0) return null; return k; }
function weightKgImperial(lb){ const l = toNum(lb); if(l===null||l<=0) return null; return l * 0.45359237; }

function computeBMI(kg, meters){ if(!Number.isFinite(kg) || !Number.isFinite(meters) || meters<=0) return null; return kg / (meters*meters); }
function bmiCategory(b){ if(b===null) return {name:'—', color:'#94a3b8', note:'Enter data'}; if(b < 18.5) return {name:'Underweight', color:'#60a5fa', note:'Below healthy range'}; if(b < 25) return {name:'Normal', color:'#10b981', note:'Healthy range'}; if(b < 30) return {name:'Overweight', color:'#f59e0b', note:'Above healthy range'}; return {name:'Obese', color:'#ef4444', note:'Well above healthy range'}; }

function healthyRangeKg(meters){
  if(!Number.isFinite(meters)) return null;
  const low = 18.5 * meters * meters;
  const high = 25 * meters * meters; // using 25 as upper bound per screenshot
  return {low, high};
}

function bmiPrime(bmi){ if(!Number.isFinite(bmi)) return null; return bmi / 25; } // relative to BMI 25
function ponderalIndex(kg, meters){ if(!Number.isFinite(kg) || !Number.isFinite(meters) || meters<=0) return null; return kg / (meters*meters*meters); }

// gauge drawing mapping: map BMI 10..40 to arc length
function setGauge(bmi){
  const circumference = 220; // stroke-dasharray used in path
  if(!Number.isFinite(bmi)){ arc.style.transition='none'; arc.style.strokeDashoffset = circumference; return; }
  const min = 10, max = 40;
  const clamped = Math.max(min, Math.min(max, bmi));
  const t = (clamped - min) / (max - min); // 0..1
  const offset = Math.round(circumference * (1 - t));
  arc.style.transition = 'stroke-dashoffset 700ms cubic-bezier(.2,.9,.2,1)';
  arc.style.strokeDashoffset = offset;
}

// update UI with computed values
function updateUI(res){
  if(!res || !res.bmi){ bmiNum.textContent = '—'; bmiCat.textContent='—'; bmiText.textContent='—'; resultsList.innerHTML = `<li>BMI: —</li><li>Category: —</li><li>Healthy BMI range: 18.5 — 25</li><li>Healthy weight for height: —</li><li>BMI Prime: —</li><li>Ponderal Index: —</li>`; setGauge(null); lastEl.textContent='—'; adviceEl.textContent='Enter your measurements.'; return; }
  const b = res.bmi;
  bmiNum.textContent = round(b,2);
  const cat = bmiCategory(b);
  bmiCat.textContent = cat.name;
  bmiCat.style.color = cat.color;
  bmiText.textContent = `${round(b,2)} kg/m² — ${cat.name}`;
  const range = healthyRangeKg(res.meters);
  const rangeText = range ? `${round(range.low,1)} kg — ${round(range.high,1)} kg` : '—';
  const bmiP = bmiPrime(b);
  const pIndex = ponderalIndex(res.kg, res.meters);
  resultsList.innerHTML = `
    <li><strong>BMI:</strong> ${round(b,2)} kg/m²</li>
    <li><strong>Category:</strong> ${cat.name}</li>
    <li><strong>Healthy BMI range:</strong> 18.5 — 25</li>
    <li><strong>Healthy weight for height:</strong> ${rangeText}</li>
    <li><strong>BMI Prime:</strong> ${round(bmiP,2)}</li>
    <li><strong>Ponderal Index:</strong> ${round(pIndex,2)} kg/m³</li>
  `;
  setGauge(b);
  lastEl.textContent = new Date(res.ts).toLocaleString();
  // advice
  let advice = '';
  if(b < 18.5) advice = 'Underweight — consider balanced nutrition to reach a healthier weight.';
  else if(b < 25) advice = 'Normal — maintain a balanced diet and regular activity.';
  else if(b < 30) advice = 'Overweight — consider lifestyle changes: diet and activity.';
  else advice = 'Obese — speak with a healthcare provider for personalized guidance.';
  adviceEl.textContent = advice;
}

// read inputs -> compute -> update
function readAndCompute(){
  if(units === 'metric'){
    const kg = weightKgMetric(weightEl.value);
    const meters = heightMetersMetric(heightCmEl.value);
    const bmi = (kg!==null && meters!==null) ? computeBMI(kg, meters) : null;
    const ts = new Date().toISOString();
    lastResult = bmi ? { bmi, kg, meters, units:'metric', age: toNum(ageEl.value)||null, sex: sexEl.value||null, ts } : null;
    updateUI(lastResult);
    return lastResult;
  } else {
    const kg = weightKgImperial(weightEl.value);
    const meters = heightMetersImperial(feetEl.value, inchesEl.value);
    const bmi = (kg!==null && meters!==null) ? computeBMI(kg, meters) : null;
    const ts = new Date().toISOString();
    lastResult = bmi ? { bmi, kg, meters, units:'imperial', age: toNum(ageEl.value)||null, sex: sexEl.value||null, ts } : null;
    updateUI(lastResult);
    return lastResult;
  }
}

// history
function loadHistory(){ try{ const raw = localStorage.getItem(STORAGE); if(!raw) return []; const arr = JSON.parse(raw); return Array.isArray(arr)?arr:[]; }catch(e){ return []; } }
function saveHistory(arr){ try{ localStorage.setItem(STORAGE, JSON.stringify(arr)); }catch(e){} }
function renderHistory(){
  const arr = loadHistory();
  if(!arr.length){ historyEl.innerHTML = '<div class="small muted">No saved results.</div>'; return; }
  historyEl.innerHTML = '';
  arr.forEach(it=>{
    const div = document.createElement('div'); div.className='histItem';
    const left = document.createElement('div');
    left.innerHTML = `<strong>${round(it.bmi,2)}</strong> <div class="small muted">${it.units==='metric' ? round(it.kg,1)+' kg' : Math.round(it.kg/0.45359237)+' lb'}</div>`;
    const right = document.createElement('div'); right.className='small muted';
    right.innerHTML = `${new Date(it.ts).toLocaleString()}<div style="margin-top:6px"><button class="ghost" style="padding:6px;border-radius:6px" data-ts="${it.ts}">Load</button></div>`;
    div.appendChild(left); div.appendChild(right); historyEl.appendChild(div);
    right.querySelector('button').addEventListener('click', ()=> loadEntry(it));
  });
}

function addHistory(entry){
  const arr = loadHistory(); arr.unshift(entry); if(arr.length>40) arr.length=40; saveHistory(arr); renderHistory();
}
function clearHistory(){ localStorage.removeItem(STORAGE); renderHistory(); }

// load saved entry into form
function loadEntry(it){
  if(!it) return;
  if(it.units === 'metric'){
    btnMetric.click();
    weightEl.value = round(it.kg,1);
    heightCmEl.value = Math.round(it.meters * 100);
  } else {
    btnImperial.click();
    weightEl.value = round(it.kg/0.45359237,1);
    const totalIn = it.meters / 0.0254;
    const ft = Math.floor(totalIn/12);
    const inch = Math.round((totalIn - ft*12)*10)/10;
    feetEl.value = ft;
    inchesEl.value = inch;
  }
  ageEl.value = it.age || '';
  sexEl.value = it.sex || '';
  readAndCompute();
}

// UI wiring
btnMetric.addEventListener('click', ()=> {
  units = 'metric';
  btnMetric.classList.add('active'); btnMetric.setAttribute('aria-pressed','true');
  btnImperial.classList.remove('active'); btnImperial.setAttribute('aria-pressed','false');
  feetField.style.display = 'none'; inchesField.style.display='none';
  heightCmEl.style.display='block'; document.getElementById('heightHelp').textContent='centimetres (cm)';
  weightEl.placeholder='kg'; document.getElementById('weightHelp').textContent='kilograms (kg)';
  // if imperial inputs present, convert to metric display (optional)
  if(feetEl.value || inchesEl.value){ const m = heightMetersImperial(feetEl.value||0, inchesEl.value||0); if(m) heightCmEl.value = Math.round(m*100); }
  readAndCompute();
});
btnImperial.addEventListener('click', ()=> {
  units = 'imperial';
  btnImperial.classList.add('active'); btnImperial.setAttribute('aria-pressed','true');
  btnMetric.classList.remove('active'); btnMetric.setAttribute('aria-pressed','false');
  feetField.style.display = 'block'; inchesField.style.display='block';
  heightCmEl.style.display='none'; document.getElementById('heightHelp').textContent='Use Feet & Inches';
  weightEl.placeholder='lb'; document.getElementById('weightHelp').textContent='pounds (lb)';
  // convert cm to ft/in if possible
  if(heightCmEl.value){ const m = heightMetersMetric(heightCmEl.value); if(m){ const totalIn = m/0.0254; const ft = Math.floor(totalIn/12); const inch = Math.round((totalIn - ft*12)*10)/10; feetEl.value = ft; inchesEl.value = inch; } }
  readAndCompute();
});

[weightEl, heightCmEl, feetEl, inchesEl, ageEl, sexEl].forEach(el => {
  el.addEventListener('input', ()=> readAndCompute());
  el.addEventListener('keydown', (e)=> { if(e.key==='Enter'){ e.preventDefault(); readAndCompute(); } });
});

calcBtn.addEventListener('click', ()=> { readAndCompute(); bmiNum.scrollIntoView({behavior:'smooth', block:'center'}); });
clearBtn.addEventListener('click', ()=> {
  weightEl.value=''; heightCmEl.value=''; feetEl.value=''; inchesEl.value=''; ageEl.value=''; sexEl.value=''; lastResult=null; updateUI(null);
});

// copy & save
copyBtn.addEventListener('click', ()=> {
  if(!lastResult || !lastResult.bmi) return alert('No result to copy.');
  const txt = `BMI ${round(lastResult.bmi,2)} (${bmiCategory(lastResult.bmi).name}) — ${round(lastResult.kg,1)} kg — ${new Date(lastResult.ts).toLocaleString()}`;
  if(navigator.clipboard) navigator.clipboard.writeText(txt).then(()=> alert('Copied to clipboard.'));
  else { alert('Copy not supported in this browser.'); }
});

saveBtn.addEventListener('click', ()=> {
  if(!lastResult || !lastResult.bmi) return alert('Calculate before saving.');
  addHistory(lastResult);
  alert('Saved.');
});

clearHistBtn.addEventListener('click', ()=> { if(confirm('Clear saved BMI history?')){ clearHistory(); }});

// init
renderHistory();
updateUI(null);

// expose for testing
window.fixvityBMI_v2 = { readAndCompute, loadHistory, clearHistory };

</script>
</body>
</html>
