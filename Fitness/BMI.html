<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ultimate BMI Calculator — Needle Adjusted</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
:root{
  --bg:#f4f8fb; --card:#ffffff; --accent:#0b7285; --muted:#6b7176;
  --border:rgba(18,24,30,0.08); --danger:#ef4444; --ok:#10b981; --warn:#f59e0b; --deep:#08323a;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);-webkit-font-smoothing:antialiased}
.container{max-width:980px;margin:16px auto;padding:12px}
.card{background:var(--card);border-radius:16px;padding:12px;box-shadow:0 18px 36px rgba(12,18,24,0.06);overflow:visible}
.header{display:flex;justify-content:space-between;align-items:flex-start;padding:6px 6px 10px}
.title{font-size:28px;margin:0;font-weight:800}
.brand{color:var(--muted);font-weight:600;font-size:13px}

/* grid */
.grid{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:980px){ .grid{grid-template-columns:1fr 420px} }

/* input area */
.inputs{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid var(--border)}
.input{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);font-size:15px;background:transparent}
.controls{display:flex;align-items:center;gap:10px;margin-top:12px;flex-wrap:wrap;justify-content:space-between}
.btnPrimary{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;font-weight:800;cursor:pointer}
.btnGhost{background:#fff;border:1px solid var(--border);padding:9px 12px;border-radius:10px;cursor:pointer}

/* results / gauge */
.results{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid var(--border);overflow:visible}
.svgWrap{width:100%;display:flex;justify-content:center;align-items:center;padding:6px 18px 0;box-sizing:border-box}
svg.gauge{width:100%;height:auto;display:block}
.bmiNumber{font-weight:600;font-size:36px;color:var(--deep);margin:0;line-height:0.95}
@media(min-width:900px){ .bmiNumber{font-size:46px} }
.unit{font-size:16px;color:var(--muted);margin-left:8px}
.category{font-size:22px;font-weight:800;margin-left:18px}
.pill{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;background:#fff;border:1px solid var(--border);font-weight:700;margin-top:8px}
.detailGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
@media(max-width:520px){ .detailGrid{grid-template-columns:1fr} }
.cardItem{background:#fff;border-radius:10px;padding:10px;border:1px solid var(--border)}
.muted{color:var(--muted);font-size:13px}

/* small upward nudge for svg on narrow screens */
@media(max-width:420px){ .svgWrap{padding-top:2px} }
</style>
</head>
<body>
<div class="container">
  <div class="card" role="main" aria-labelledby="mainTitle">
    <div class="header">
      <h1 id="mainTitle" class="title">Ultimate BMI Calculator</h1>
      <div class="brand">Fixvity</div>
    </div>

    <div class="grid">
      <!-- LEFT (inputs) -->
      <section class="inputs" aria-label="Calculator inputs">
        <div style="display:flex;gap:8px;margin-bottom:12px">
          <button id="tabMetric" style="padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#e8fbfd;font-weight:700">Metric</button>
          <button id="tabImperial" style="padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;font-weight:700">Imperial</button>
          <button id="tabOther" style="padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:#fff;font-weight:700">Other</button>
        </div>

        <div style="display:grid;gap:12px">
          <div>
            <label style="font-size:13px;color:#0b1720;margin-bottom:6px;display:block">Age (years)</label>
            <input id="age" class="input" type="number" min="2" max="120" placeholder="25" />
          </div>

          <div>
            <label style="font-size:13px;color:#0b1720;margin-bottom:6px;display:block">Sex</label>
            <select id="sex" class="input">
              <option value="">Prefer not to say</option>
              <option value="female">Female</option>
              <option value="male">Male</option>
            </select>
          </div>

          <div>
            <label style="font-size:13px;color:#0b1720;margin-bottom:6px;display:block">Weight (kg)</label>
            <input id="weightKg" class="input" type="number" step="0.1" placeholder="72.5" />
          </div>

          <div>
            <label style="font-size:13px;color:#0b1720;margin-bottom:6px;display:block">Height (cm)</label>
            <input id="heightCm" class="input" type="number" step="0.1" placeholder="175" />
          </div>

          <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
            <div style="display:flex;gap:8px">
              <button id="btnCalc" class="btnPrimary">Calculate</button>
              <button id="btnClear" class="btnGhost">Clear</button>
            </div>
            <div style="display:flex;gap:8px">
              <button id="btnSave" class="btnGhost">Save</button>
              <button id="btnPNG" class="btnGhost">Download PNG</button>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT (results + gauge) -->
      <aside class="results" id="resultCard" aria-live="polite">
        <div class="svgWrap" aria-hidden="false">
          <svg id="gauge" class="gauge" viewBox="0 0 960 520" preserveAspectRatio="xMidYMid meet" role="img" aria-label="BMI gauge">
            <!-- background semi arc -->
            <path id="bg" d="" stroke="rgba(0,0,0,0.06)" stroke-width="60" fill="none" stroke-linecap="butt"></path>

            <!-- colored segments -->
            <path id="seg0" stroke="#ef4444" stroke-width="56" fill="none" stroke-linecap="butt"></path>
            <path id="seg1" stroke="#10b981" stroke-width="56" fill="none" stroke-linecap="butt"></path>
            <path id="seg2" stroke="#f59e0b" stroke-width="56" fill="none" stroke-linecap="butt"></path>
            <path id="seg3" stroke="#ff8c42" stroke-width="56" fill="none" stroke-linecap="butt"></path>
            <path id="seg4" stroke="#e74c3c" stroke-width="56" fill="none" stroke-linecap="butt"></path>
            <path id="seg5" stroke="#812525" stroke-width="56" fill="none" stroke-linecap="butt"></path>

            <!-- subtle top red mark -->
            <path id="topMark" d="" stroke="#ef4444" stroke-opacity="0.12" stroke-width="10" fill="none" stroke-linecap="round"></path>

            <!-- ticks and labels -->
            <g id="ticks"></g>

            <!-- needle (SHORTENED) - changed here: y2 moved from 260 -> 320 and stroke-width reduced to 6 -->
            <line id="needle" x1="480" y1="400" x2="480" y2="320" stroke="#08151a" stroke-width="6" stroke-linecap="round" transform="rotate(-90 480 400)"></line>
            <circle cx="480" cy="400" r="10" fill="#08151a"></circle>
          </svg>
        </div>

        <div style="margin-top:6px;display:flex;align-items:center;gap:12px;flex-wrap:wrap">
          <div style="display:flex;align-items:center">
            <div id="bmiNumber" class="bmiNumber">—</div>
            <div class="unit">kg/m²</div>
          </div>
          <div>
            <div id="bmiCategory" class="category" style="color:var(--muted)">Enter values & calculate</div>
          </div>
        </div>

        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
          <div style="flex:1;min-width:220px">
            <div>
              <div class="pill"><span style="width:14px;height:14px;background:#ef4444;border-radius:6px;display:inline-block"></span>Underweight</div>
              <div class="pill"><span style="width:14px;height:14px;background:#10b981;border-radius:6px;display:inline-block"></span>Normal</div>
              <div class="pill"><span style="width:14px;height:14px;background:#f59e0b;border-radius:6px;display:inline-block"></span>Overweight</div>
              <div class="pill"><span style="width:14px;height:14px;background:#ff8c42;border-radius:6px;display:inline-block"></span>Obesity I</div>
              <div class="pill"><span style="width:14px;height:14px;background:#e74c3c;border-radius:6px;display:inline-block"></span>Obesity II</div>
              <div class="pill"><span style="width:14px;height:14px;background:#812525;border-radius:6px;display:inline-block"></span>Obesity III</div>
            </div>
          </div>

          <div style="flex:1;min-width:260px">
            <div class="detailGrid">
              <div class="cardItem"><div class="muted">Healthy BMI range</div><div style="font-weight:800;margin-top:6px">18.5 — 24.9</div></div>
              <div class="cardItem"><div class="muted">BMI Prime</div><div id="bmiPrime" style="font-weight:800;margin-top:6px">—</div></div>
              <div class="cardItem"><div class="muted">Ponderal Index</div><div id="ponderal" style="font-weight:800;margin-top:6px">—</div></div>
              <div class="cardItem"><div class="muted">Healthy weight</div><div id="healthyRange" style="font-weight:800;margin-top:6px">—</div></div>
            </div>
          </div>
        </div>

      </aside>
    </div>
  </div>
</div>

<script>
/* geometry constants */
const CX = 480, CY = 400, R = 300;
const segEls = ['seg0','seg1','seg2','seg3','seg4','seg5'].map(id=>document.getElementById(id));
const bg = document.getElementById('bg'), topMark = document.getElementById('topMark'), ticksG = document.getElementById('ticks');
const needle = document.getElementById('needle');

function polar(cx,cy,r,deg){ const rad=(deg-90)*Math.PI/180; return {x:cx + r*Math.cos(rad), y:cy + r*Math.sin(rad)}; }
function arc(cx,cy,r,sdeg,edeg){ const p1=polar(cx,cy,r,edeg); const p2=polar(cx,cy,r,sdeg); return `M ${p1.x} ${p1.y} A ${r} ${r} 0 0 0 ${p2.x} ${p2.y}`; }
function mapBMI(bmi){ const v=Math.max(0, Math.min(bmi,60)); return (v/60)*180 - 90; }

function drawGauge(){
  bg.setAttribute('d', arc(CX,CY,R+30,-90,90));
  const ranges = [[0,18.5],[18.5,24.9],[25,29.9],[30,34.9],[35,39.9],[40,60]];
  ranges.forEach((rg,i)=>{
    segEls[i].setAttribute('d', arc(CX,CY,R, mapBMI(rg[0]), mapBMI(Math.min(rg[1],60))));
  });
  topMark.setAttribute('d', arc(CX,CY,R+10, -50, 50));

  // ticks and labels
  const labels = [0,5,10,15,20,25,30,35,40,50,60];
  ticksG.innerHTML='';
  labels.forEach(v=>{
    const deg = mapBMI(v);
    const out = polar(CX,CY,R+60,deg), inn = polar(CX,CY,R-10,deg);
    const ln = document.createElementNS('http://www.w3.org/2000/svg','line');
    ln.setAttribute('x1',out.x); ln.setAttribute('y1',out.y);
    ln.setAttribute('x2',inn.x); ln.setAttribute('y2',inn.y);
    ln.setAttribute('stroke','rgba(2,6,23,0.06)'); ln.setAttribute('stroke-width',3);
    ticksG.appendChild(ln);
    const lp = polar(CX,CY,R+110,deg);
    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x',lp.x); t.setAttribute('y',lp.y+8);
    t.setAttribute('text-anchor','middle');
    const size = (v===25||v===30||v===35) ? 30 : 22;
    t.setAttribute('font-size',size);
    t.setAttribute('font-weight',800);
    t.setAttribute('fill','#0b1720');
    t.setAttribute('stroke','#ffffff'); t.setAttribute('stroke-width',6); t.setAttribute('paint-order','stroke');
    t.textContent = v;
    ticksG.appendChild(t);
  });
}
drawGauge();

/* small convert + calc */
const weightKg = document.getElementById('weightKg'), heightCm = document.getElementById('heightCm');
const btnCalc = document.getElementById('btnCalc'), btnClear = document.getElementById('btnClear');
const bmiNumber = document.getElementById('bmiNumber'), bmiCategory = document.getElementById('bmiCategory');
const bmiPrimeEl = document.getElementById('bmiPrime'), ponderalEl = document.getElementById('ponderal'), healthyRangeEl = document.getElementById('healthyRange');
const interpretation = document.getElementById('interpretation');

function cmToM(cm){ const v=Number(cm); return v>0 ? v/100 : null; }
function categoryFor(bmi){
  if(bmi < 18.5) return {name:'Underweight', color:'#ef4444', note:'Below healthy range.'};
  if(bmi < 25) return {name:'Normal', color:'#10b981', note:'Within healthy range.'};
  if(bmi < 30) return {name:'Overweight', color:'#f59e0b', note:'Above healthy range.'};
  if(bmi < 35) return {name:'Obesity I', color:'#ff8c42', note:'Obesity I.'};
  if(bmi < 40) return {name:'Obesity II', color:'#e74c3c', note:'Obesity II.'};
  return {name:'Obesity III', color:'#812525', note:'Severe obesity.'};
}

function setNeedle(bmi){
  const angle = mapBMI(bmi);
  needle.setAttribute('transform', `rotate(${angle} ${CX} ${CY})`);
}

function render(bmi, kg, m){
  bmiNumber.textContent = bmi.toFixed(2);
  const cat = categoryFor(bmi);
  bmiCategory.textContent = cat.name;
  bmiCategory.style.color = cat.color;
  interpretation && (interpretation.textContent = cat.note);
  const bmiPrime = bmi / 25;
  const ponderal = kg / (m*m*m);
  bmiPrimeEl && (bmiPrimeEl.textContent = bmiPrime.toFixed(2));
  ponderalEl && (ponderalEl.textContent = `${ponderal.toFixed(2)} kg/m³`);
  const low = 18.5*m*m, high = 24.9*m*m;
  healthyRangeEl && (healthyRangeEl.textContent = `${low.toFixed(1)} kg — ${high.toFixed(1)} kg`);
  setNeedle(bmi);
}

btnCalc.addEventListener('click', ()=>{
  const kg = Number(weightKg.value);
  const h = Number(heightCm.value);
  if(!(kg>0)){ alert('Enter weight (kg)'); return; }
  if(!(h>0)){ alert('Enter height (cm)'); return; }
  const m = cmToM(h), bmi = kg / (m*m);
  render(bmi, kg, m);
});

btnClear.addEventListener('click', ()=>{
  weightKg.value=''; heightCm.value='';
  bmiNumber.textContent='—';
  bmiCategory.textContent='Enter values & calculate';
  bmiPrimeEl.textContent='—'; ponderalEl.textContent='—'; healthyRangeEl.textContent='—';
  interpretation && (interpretation.textContent='No data yet.');
  needle.setAttribute('transform', `rotate(-90 ${CX} ${CY})`);
});
needle.setAttribute('transform', `rotate(-90 ${CX} ${CY})`);

let rt;
window.addEventListener('resize', ()=>{ if(rt) clearTimeout(rt); rt=setTimeout(()=>{ drawGauge(); },120); });
</script>
</body>
</html>
